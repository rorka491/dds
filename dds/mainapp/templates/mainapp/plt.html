<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Линейная Регрессия</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

<h1>Загрузите CSV файл для линейной регрессии</h1>
<input type="file" id="csv-file" accept=".csv" />
<div id="result"></div>
<div id="graph"></div>

<script>
    document.getElementById("csv-file").addEventListener("change", handleFileUpload, false);

    function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) {
            alert("Пожалуйста, выберите файл.");
            return;
        }

        Papa.parse(file, {
            complete: function(results) {
                const data = results.data;
                const x = [];
                const y = [];

                data.forEach(row => {
                    if (row[0] && row[1]) {
                        x.push(parseFloat(row[0]));
                        y.push(parseFloat(row[1]));
                    }
                });

                performLinearRegression(x, y);
            },
            header: false
        });
    }

    function performLinearRegression(x, y) {
        const n = x.length;
        let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;

        for (let i = 0; i < n; i++) {
            sumX += x[i];
            sumY += y[i];
            sumXY += x[i] * y[i];
            sumX2 += x[i] * x[i];
        }


        const k = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        const b = (sumY - k * sumX) / n;


        document.getElementById("result").innerHTML = `
            <p>Коэффициент наклона (k): ${k}</p>
            <p>Свободный член (b): ${b}</p>
        `;

        plotGraph(x, y, k, b);
    }

    function plotGraph(x, y, k, b) {
        const trace1 = {
            x: x,
            y: y,
            mode: 'markers',
            type: 'scatter',
            name: 'Точки данных',
            marker: { color: 'blue' }
        };

        const trace2 = {
            x: x,
            y: x.map(xi => k * xi + b),
            mode: 'lines',
            type: 'scatter',
            name: 'Линия регрессии',
            line: { color: 'red' }
        };

        const layout = {
            title: 'Линейная регрессия',
            xaxis: { title: 'X' },
            yaxis: { title: 'Y' },
        };

        Plotly.newPlot('graph', [trace1, trace2], layout);
    }
</script>

</body>
</html>
